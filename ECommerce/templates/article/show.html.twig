{% extends 'base.html.twig' %}

{% block title %}Article{% endblock %}

{% block cartNumber %}{{ cart | length }}{% endblock %}

{% block body %}


    <p>PANIER QTY : {{ cart | length }}</p>
    {% set total = 0 %}
    {% for item in cart %}
        <img src="{{ item.image }}">
        <p> Nom : {{ item.nom }}</p>
        <p>{{ item.qty }}</p>
        <p>{{ item.qty * item.unitPrice }} €</p>
        {% set total = total + item.qty * item.unitPrice %}
        <button onclick="removeFromCart({{ item.id }})">Retirer du panier</button>
    {% endfor %}
   Total : {{ total }} €
    <h1>Article</h1>

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <td>{{ article.id }}</td>
            </tr>
            <tr>
                <th>Nom</th>
                <td>{{ article.nom }}</td>
            </tr>
            <tr>
                <th>Categorie</th>
                <td>{{ article.categorie }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ article.description }}</td>
            </tr>
            <tr>
                <th>Caracteristiques</th>
                <td>{{ article.caracteristiques }}</td>
            </tr>
            <tr>
                <th>PrixUnitaire</th>
                <td>{{ article.prixUnitaire }}</td>
            </tr>
            <tr>
                <th>Poids</th>
                <td>{{ article.poids }}</td>
            </tr>
            <tr>
                <th>QteEnStock</th>
                <td>{{ article.qteEnStock }}</td>
            </tr>
            <tr>
                <th>IsNew</th>
                <td>{{ article.isNew ? 'Yes' : 'No' }}</td>
            </tr>
            <tr>
                <th>Promotion</th>
                <td>{{ article.promotion }}</td>
            </tr>
        <tr>
            <th>Images</th>
            <td>{% for image in article.images %}
                <img src="{{ image.lien }}"></img>
            {% endfor %}
            </td>
        </tr>
        </tbody>
    </table>

    <div>
        <label>Quantité:</label>
        <input type="number" id="qty" value="1">
    </div>
    <button id="test"> Ajouter au panier</button>

    <a href="{{ path('article_index') }}">back to list</a>

    <a href="{{ path('article_edit', {'id': article.id}) }}">edit</a>

    {{ include('article/_delete_form.html.twig') }}

    <script>
        let imageArticle;
        {% for image in article.images %}
        {% if loop.first %}
            imageArticle = "{{ image.lien }}";
        {% endif %}
        {% endfor %}
        $('#test').click(function () {
            let data = {
                id: "{{ article.id }}",
                nom: "{{ article.nom }}",
                qty: $('#qty').val(),
                unitPrice: {{ article.prixUnitaire }},
                image: imageArticle
            };
            $.ajax({
                type: "POST",
                url: '/addToCart',
                data: data,
                success: function (data) {
                    console.log(data);
                }
            });
        });

        function removeFromCart(id) {
            let data = {
                id: id
            };
            $.ajax({
                type: "POST",
                url: '/removeFromCart',
                data: data,
                success: function (data) {
                    console.log(data);
                }
            });
        }
    </script>
{% endblock %}
